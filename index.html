<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alugue Aqui</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Mant茅m o visual bonito original */
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:0; }
    header { background: #0070f3; color: white; padding: 20px; text-align:center; }
    header img { max-width:150px; display:block; margin:0 auto 10px; }
    h1 { margin:0; }
    #imoveis-container { display:grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap:20px; padding:20px; max-width:1200px; margin:0 auto; }
    .imovel { background:white; padding:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); text-align:center; }
    .imovel img { width:100%; height:180px; object-fit:cover; border-radius:8px; }
    .imovel h3 { margin:10px 0 5px; }
    .imovel p { margin:5px 0; }
    .imovel a { display:inline-block; margin-top:10px; background:#25d366; color:white; padding:10px 15px; border-radius:5px; text-decoration:none; font-weight:bold; }
    .imovel a:hover { background:#1ebe57; }

    /* Bot茫o Adicionar Im贸vel */
    #add-imovel-btn { display:block; margin:20px auto; padding:10px 20px; background:#ff6600; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
    #add-imovel-btn:hover { background:#e65c00; }

    /* Formul谩rio de Adicionar Im贸vel */
    #form-imovel { display:none; max-width:400px; margin:20px auto; background:white; padding:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    #form-imovel input, #form-imovel textarea { width:100%; margin-bottom:10px; padding:8px; border-radius:5px; border:1px solid #ccc; }
    #form-imovel button { background:#0070f3; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer; font-weight:bold; }
    #form-imovel button:hover { background:#005bb5; }
  </style>
</head>
<body>

<header>
  <img src="img/logo.png" alt="Alugue Aqui Logo">
  <h1>Encontre o im贸vel ideal</h1>
  <p>R谩pido, f谩cil e seguro.</p>
</header>

<main>
  <button id="add-imovel-btn">Adicionar Im贸vel</button>

  <form id="form-imovel">
    <input type="password" id="senha" placeholder="Digite a senha" required>
    <input type="text" id="titulo" placeholder="T铆tulo do im贸vel" required>
    <input type="text" id="preco" placeholder="Pre莽o" required>
    <textarea id="descricao" placeholder="Descri莽茫o" required></textarea>
    <input type="text" id="imagem" placeholder="URL da imagem" required>
    <input type="text" id="whatsapp" placeholder="WhatsApp (somente n煤meros)" required>
    <button type="submit">Enviar Im贸vel</button>
  </form>

  <section id="imoveis-container">
    <!-- Im贸veis aparecer茫o aqui -->
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  // Supabase configurado
  const supabaseUrl = "https://wiesqachdwrdvuqmbudh.supabase.co";
  const supabaseKey = "sb_publishable_PVRWMM9b6IGK8EMPSLmVJQ_EOZG5DZb";
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  const container = document.getElementById("imoveis-container");
  const form = document.getElementById("form-imovel");
  const btnAdd = document.getElementById("add-imovel-btn");

  const SENHA_ADMIN = "326190"; // senha s贸 sua

  // Mostrar formul谩rio somente ao clicar
  btnAdd.addEventListener("click", () => {
    form.style.display = "block";
  });

  // Envio do im贸vel
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const senha = document.getElementById("senha").value;
    if(senha !== SENHA_ADMIN){
      alert("Senha incorreta!");
      return;
    }

    const titulo = document.getElementById("titulo").value;
    const preco = document.getElementById("preco").value;
    const descricao = document.getElementById("descricao").value;
    const imagem = document.getElementById("imagem").value;
    const whatsapp = document.getElementById("whatsapp").value;

    const { data, error } = await supabase
      .from("imoveis")
      .insert([{ titulo, preco, descricao, imagem, whatsapp }]);

    if(error){
      alert("Erro ao adicionar im贸vel");
      console.error(error);
      return;
    }

    alert("Im贸vel adicionado com sucesso!");
    form.reset();
    form.style.display = "none";
    carregarImoveis();
  });

  // Carregar im贸veis
  async function carregarImoveis() {
    container.innerHTML = "Carregando im贸veis...";
    const { data, error } = await supabase
      .from("imoveis")
      .select("*")
      .order("created_at", { ascending: false });

    if(error){
      container.innerHTML = "Erro ao carregar im贸veis";
      console.error(error);
      return;
    }

    if(!data || data.length === 0){
      container.innerHTML = "Nenhum im贸vel cadastrado ainda";
      return;
    }

    container.innerHTML = "";
    data.forEach(imovel => {
      const div = document.createElement("div");
      div.classList.add("imovel");
      div.innerHTML = `
        <img src="${imovel.imagem}" alt="${imovel.titulo}" />
        <h3>${imovel.titulo}</h3>
        <p>${imovel.descricao}</p>
        <p><strong>Pre莽o:</strong> ${imovel.preco}</p>
        <a href="https://wa.me/${imovel.whatsapp}" target="_blank"> Contato WhatsApp</a>
      `;
      container.appendChild(div);
    });
  }

  window.addEventListener("DOMContentLoaded", carregarImoveis);
</script>

</body>
</html>
